{"version":3,"sources":["../../app-es6/controllers/NegociacaoController.js"],"names":["currentInstance","negociacaoController","MensagemView","NegociacoesView","ListaNegociacoes","Mensagem","Negociacao","NegociacoesService","DateHelper","Bind","NegociacaoController","$","document","querySelector","bind","_inputData","_inputQuantidade","_inputValor","_lista","_mensagem","_ordemAtual","_service","_init","lista","then","negociacoes","forEach","adiciona","item","catch","texto","erro","setInterval","_importaNegociacoes","event","preventDefault","negociacao","_criaNegociacao","cadastra","mensagem","_limpaFormulario","textToDate","value","parseInt","parseFloat","focus","apaga","esvazia","importa","coluna","inverteOrdem","ordena","a","b"],"mappings":"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","file":"NegociacaoController.js","sourcesContent":["import { MensagemView } from '../views/MensagemView.js';\r\nimport { NegociacoesView } from '../views/NegociacoesView.js'; \r\nimport { ListaNegociacoes } from '../models/ListaNegociacoes.js'; \r\nimport { Mensagem } from '../models/Mensagem.js';\r\nimport { Negociacao } from '../models/Negociacao.js';\r\nimport { NegociacoesService } from '../services/NegociacoesService.js';\r\nimport { DateHelper } from '../helpers/DateHelper.js';\r\nimport { Bind } from '../helpers/Bind.js';\r\n\r\n\r\nclass NegociacaoController {\r\n    constructor (){\r\n        let $ = document.querySelector.bind(document);\r\n    \r\n        this._inputData = $(\"#data\");\r\n        this._inputQuantidade = $(\"#quantidade\");\r\n        this._inputValor = $(\"#valor\");     \r\n        this._lista = new Bind(new ListaNegociacoes(), new NegociacoesView($(\"#tableNegociacoes\")), 'adiciona', 'esvazia', 'ordena', 'inverteOrdem');\r\n        this._mensagem = new Bind(new Mensagem(), new MensagemView($(\"#mensagemView\")), 'texto');    \r\n        \r\n        this._ordemAtual = '';\r\n        this._service = new NegociacoesService();        \r\n        this._init();      \r\n    }\r\n\r\n    _init(){\r\n        this._service\r\n            .lista()\r\n            .then(negociacoes => \r\n                negociacoes.forEach(item => \r\n                    { this._lista.adiciona(item) }\r\n                )\r\n            )\r\n            .catch(erro => this._mensagem.texto = erro);              \r\n\r\n        setInterval(() => {\r\n            this._importaNegociacoes();\r\n        }, 3000);\r\n    }\r\n\r\n    adiciona(event){\r\n\r\n        event.preventDefault();\r\n        let negociacao = this._criaNegociacao();\r\n\r\n        this._service\r\n            .cadastra(negociacao)\r\n            .then(mensagem => {\r\n                this._lista.adiciona(negociacao);\r\n                this._mensagem.texto = mensagem;\r\n                this._limpaFormulario();\r\n            })\r\n            .catch(erro => this._mensagem.texto = erro);       \r\n    }\r\n\r\n    _criaNegociacao(){\r\n        return new Negociacao(\r\n            DateHelper.textToDate(this._inputData.value),\r\n            parseInt(this._inputQuantidade.value),\r\n            parseFloat(this._inputValor.value)\r\n        );\r\n    }\r\n\r\n\r\n    _limpaFormulario() {\r\n        this._inputData.value = '';\r\n        this._inputQuantidade.value = 1;\r\n        this._inputValor.value = 0.0;\r\n        this._inputData.focus();\r\n    }\r\n\r\n    apaga() {\r\n        this._service\r\n        .apaga()\r\n        .then(mensagem => {\r\n            this._lista.esvazia();\r\n                this._mensagem.texto = mensagem;\r\n        })\r\n        .catch(erro => this._mensagem.texto = erro);              \r\n    }\r\n\r\n    _importaNegociacoes() {\r\n\r\n\r\n        this._service\r\n            .importa(this._lista)\r\n            .then(negociacoes => negociacoes.forEach(negociacao => {\r\n                this._lista.adiciona(negociacao);\r\n                this._mensagem.texto = 'Negociações do período importadas'   \r\n            }))\r\n            .catch(erro => this._mensagem.texto = erro); \r\n    }\r\n\r\n    ordena(coluna){\r\n        if(this._ordemAtual == coluna){\r\n            this._lista.inverteOrdem();\r\n        }else{\r\n            this._lista.ordena((a, b) => a[coluna] - b[coluna]);\r\n        }\r\n        this._ordemAtual = coluna;\r\n    }     \r\n}\r\nlet negociacaoController = new NegociacaoController();\r\nexport function currentInstance() {\r\n    return negociacaoController;\r\n}"]}